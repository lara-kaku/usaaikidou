<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>メイン｜宇佐合気道会</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kiwi+Maru:wght@300;400;500&family=Zen+Maru+Gothic:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <div class="header-container">
            <div class="title-text">
                <div id="main-title">
                    <span class="char-block color-orange">宇</span>
                    <span class="char-block color-green">佐</span>
                    <span class="char-block color-blue">合</span>
                    <span class="char-block color-pink">気</span>
                    <span class="char-block color-yellow">道</span>
                    <span class="char-block color-purple">会</span>
                </div>
                <div id="sub-title">
                    <span class="char-block color-pink">ホームページにようこそ</span>
                </div>
            </div>
        </div>
    </header>
    
    <main>
        <section class="introduction">
            <h1>⛩️ごあいさつ</h1>
            <p>宇佐合気道会は合気道祥平塾の傘下道場です。</p>
            <p>宇佐合気道会は、１９９２年（平成４年）宇佐警察署に勤務されいていた合気道経験者の豊田氏が発起人となり警察署の道場をお借りして数人で稽古を始めました。</p>
            <p>翌年には宇佐合気道会として正式に発足し、稽古場所も現在地になりました。</p>
            <p>当会は発足より祥平塾菅沼守人師範のご指導のもと稽古を続けています。菅沼師範の講習会や毎週水曜日と土曜日の稽古を通して合気道の楽しさや奥深さを体感しています。</p>
        </section>

        <section class="recruit">
            <h1>
                <span class="tree-icon">🌳</span>会員募集
            </h1>
            <p>初心者大歓迎　家族・親子・兄弟姉妹・祖父母孫での参加もお待ちしています。</p>
            <p>年齢・性別関係なく、楽しく緩やかに合気道を行っています。</p>
            <p>宇佐合気道会では、新しい仲間をいつでも歓迎しています。</p>
            <p>「運動不足を解消したい」「家族で何か始めたい」など、きっかけは何でもOKです！</p>
            <p>体験・見学は無料です。</p>
            <p>興味・関心を持った方は迷わずお気軽にお問い合わせください。</p>
            <p><strong>会費： 社会人 2,000円／月、学生 1,000円／月</strong></p>
            
            <div class="contact-info-block">
                <h2>お問い合わせ</h2>
                <p>090-○○○○-○○○○（永家まで）</p>
            </div>
        </section>

        <section class="image">
            <img src="審査風景.JPG" alt="稽古の様子" /> 
        </section>

        <section class="info">
            <h2>🌿時間・場所</h2>
            <div class="info-container">
                <div class="info-text">
                    <p>練習日：毎週水・土曜日 19時〜20時</p>
                    <p>場所：宇佐市総合運動公園内 武道場</p>
                    <p>住所：〒879-0452 大分県宇佐市川部1591</p>
                    <p>電話：0978-37-3335</p>
                </div>
                <div class="info-map">
                    <iframe
                        src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3342.0809633988135!2d131.3599911!3d33.5386907!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x354408ad205b065d%3A0x37b9b80e85fa82c1!2z44CSODc5LTA0NTIg5aSn6Ziq5bqc5biC5a6u5Yy65bed55Sw77yS5p2x5bGx77yR!5e0!3m2!1sja!2sjp!4v1716978266500!5m2!1sja!2sjp"
                        width="100%"
                        height="300"
                        style="border:0;"
                        allowfullscreen=""
                        loading="lazy"
                        referrerpolicy="no-referrer-when-downgrade"
                    ></iframe>
                </div>
            </div>
        </section>

        <section id="monthly-notice" class="notice">
            <h2>🌸お知らせ</h2>
            <!-- 動的な月次のお知らせはここに表示されます -->
            <div id="monthly-dynamic-notice"></div>
            <!-- 固定の注意事項ブロックはここにあります -->
            <div class="important-notes-block">
                <h3>連絡</h3>
                <p>審査費用は６月２８日（土）までに持参して下さい。</p>
                <p>暑くなっていきましたので飲み物をお持ちください。</p>
                <p></p>
            </div>
        </section>

        <section id="training-schedule-section">
            <h1>
                <img src="sihanaikon.png" alt="合気道アイコン" class="swing-icon" />
                稽古日程
            </h1>
            <div class="controls">
                <label for="year-select">年:</label>
                <select id="year-select"></select>
                <label for="month-select">月:</label>
                <select id="month-select">
                    <option value="0">1月</option>
                    <option value="1">2月</option>
                    <option value="2">3月</option>
                    <option value="3">4月</option>
                    <option value="4">5月</option>
                    <option value="5">6月</option>
                    <option value="6">7月</option>
                    <option value="7">8月</option>
                    <option value="8">9月</option>
                    <option value="9">10月</option>
                    <option value="10">11月</option>
                    <option value="11">12月</option>
                </select>
            </div>
            <div id="calendar-container">
                <div id="calendar"></div>
            </div>
        </section>

        <section class="sub-navigation">
            <ul>
                <li><a href="past.html" class="button-stump">過去の活動を見る</a></li>
                <li><a href="youtube.html" class="button-stump">動画を見る</a></li>
                <li><a href="faq.html" class="button-stump">質問コーナー</a></li>
            </ul>
        </section>
    </main>

    <footer>
        <p>&copy;非公式 2025 宇佐合気道会</p>
    </footer>

    <script>
        // DOMContentLoadedイベントリスナーで囲むことで、HTMLの読み込み完了後にスクリプトを実行します
        document.addEventListener('DOMContentLoaded', (event) => {
            const yearSelect = document.getElementById("year-select");
            const monthSelect = document.getElementById("month-select");
            const calendarDiv = document.getElementById("calendar");
            const monthlyDynamicNoticeDiv = document.getElementById("monthly-dynamic-notice"); // JavaScriptで更新する対象要素

            // eventDatesは通常のイベントと、期間指定イベントで動的に追加されるイベントの両方を含む
            const eventDates = {}; 

            /**
             * 指定された期間の日付にイベントを追加するヘルパー関数
             * @param {string} startDateStr - 開始日の文字列 (YYYY-MM-DD)
             * @param {string} endDateStr - 終了日の文字列 (YYYY-MM-DD)
             * @param {string|Array<string>} type - イベントのタイプ (例: "closed", "holiday", ["event", "closed"])
             * @param {string|Array<string>} text - イベントの表示テキスト (例: "お盆休み", ["演武会", "稽古休み"])
             */
            function addDateRangeEvent(startDateStr, endDateStr, type, text) {
                const startDate = new Date(startDateStr);
                const endDate = new Date(endDateStr);
                let currentDate = new Date(startDate);

                while (currentDate <= endDate) {
                    const year = currentDate.getFullYear();
                    const month = (currentDate.getMonth() + 1).toString().padStart(2, '0');
                    const day = currentDate.getDate().toString().padStart(2, '0');
                    const formattedDate = `${year}-${month}-${day}`;

                    // 既にイベントがある場合は既存の情報を保持しつつ追加
                    if (eventDates[formattedDate]) {
                        const existingType = Array.isArray(eventDates[formattedDate].type) ? [...eventDates[formattedDate].type] : [eventDates[formattedDate].type];
                        const existingText = Array.isArray(eventDates[formattedDate].text) ? [...eventDates[formattedDate].text] : [eventDates[formattedDate].text];
                        
                        const newTypes = Array.isArray(type) ? type : [type];
                        const newTexts = Array.isArray(text) ? text : [text];

                        eventDates[formattedDate] = {
                            type: [...new Set([...existingType, ...newTypes])], // 重複を除いてタイプを結合
                            text: [...new Set([...existingText, ...newTexts])]  // 重複を除いてテキストを結合
                        };
                    } else {
                        eventDates[formattedDate] = { type: type, text: text };
                    }
                    currentDate.setDate(currentDate.getDate() + 1); // 次の日へ
                }
            }

            // --- ここでイベントを定義します ---

            // 個別のイベント (2025年)
            eventDates["2025-01-01"] = { type: "holiday", text: "元日" }; 
            eventDates["2025-01-13"] = { type: "holiday", text: "成人の日" };
            eventDates["2025-02-11"] = { type: "holiday", text: "建国記念の日" };
            eventDates["2025-03-20"] = { type: "holiday", text: "春分の日" };
            eventDates["2025-04-29"] = { type: "holiday", text: "昭和の日" };
            // 5月3日は演武会と稽古休みを両方表示 (憲法記念日を追加)
            eventDates["2025-05-03"] = { type: ["event", "closed", "holiday"], text: ["憲法記念日", "演武会", "稽古休み"] }; 
            eventDates["2025-05-04"] = { type: "holiday", text: "みどりの日" }; 
            eventDates["2025-05-05"] = { type: "holiday", text: "こどもの日" }; 
            eventDates["2025-05-06"] = { type: "holiday", text: "振替休日" };
            eventDates["2025-06-14"] = { type: "closed", text: "稽古休み" }; 
            eventDates["2025-06-29"] = { type: "event", text: "昇級昇段審査会" }; 
            eventDates["2025-07-05"] = { type: "closed", text: "稽古休み" };
            eventDates["2025-07-21"] = { type: "holiday", text: "海の日" };
            eventDates["2025-08-02"] = { type: "closed", text: "稽古休み" }; 
            eventDates["2025-08-11"] = { type: "holiday", text: "山の日" };
            eventDates["2025-08-13"] = { type: "closed", text: "稽古休み" };   
            eventDates["2025-08-16"] = { type: "closed", text: "稽古休み" }; 
            eventDates["2025-08-30"] = { type: "closed", text: "稽古休み" };        
            eventDates["2025-09-15"] = { type: "holiday", text: "敬老の日" };
            eventDates["2025-09-23"] = { type: "holiday", text: "秋分の日" };
            eventDates["2025-10-13"] = { type: "holiday", text: "スポーツの日" };
            eventDates["2025-11-03"] = { type: "holiday", text: "文化の日" };
            eventDates["2025-11-23"] = { type: ["event","holiday"], text: ["昇級昇段審査会","勤労感謝の日"] };
            eventDates["2025-11-24"] = { type: "holiday", text: "振替休日" };
            eventDates["2025-12-27"] = { type: "closed", text: "稽古休み" };
            eventDates["2025-12-31"] = { type: "closed", text: "稽古休み" };

            
            
            // --- 2026年からの国民の祝日 (自動生成) ---
            eventDates["2026-01-03"] = { type: "closed", text: "稽古休み" };
            eventDates["2026-01-07"] = { type: "closed", text: "稽古休み" };
            eventDates["2026-01-12"] = { type: "holiday", text: "成人の日" };
            eventDates["2026-02-11"] = { type: "holiday", text: "建国記念の日" };
            eventDates["2026-02-23"] = { type: "holiday", text: "天皇誕生日" };
            eventDates["2026-03-20"] = { type: "holiday", text: "春分の日" };
            eventDates["2026-04-29"] = { type: "holiday", text: "昭和の日" };
            eventDates["2026-05-03"] = { type: "holiday", text: "憲法記念日" };
            eventDates["2026-05-04"] = { type: "holiday", text: "みどりの日" };
            eventDates["2026-05-05"] = { type: "holiday", text: "こどもの日" };
            eventDates["2026-05-06"] = { type: "holiday", text: "振替休日" };
            eventDates["2026-07-20"] = { type: "holiday", text: "海の日" };
            eventDates["2026-08-11"] = { type: "holiday", text: "山の日" };
            eventDates["2026-09-21"] = { type: "holiday", text: "敬老の日" };
            eventDates["2026-09-22"] = { type: "holiday", text: "国民の休日" }; // 国民の休日
            eventDates["2026-09-23"] = { type: "holiday", text: "秋分の日" };
            eventDates["2026-10-12"] = { type: "holiday", text: "スポーツの日" };
            eventDates["2026-11-03"] = { type: "holiday", text: "文化の日" };
            eventDates["2026-11-23"] = { type: "holiday", text: "勤労感謝の日" };
            eventDates["2026-12-26"] = { type: "closed", text: "稽古休み" };
            eventDates["2026-12-30"] = { type: "closed", text: "稽古休み" };

            // --- 2027年からの国民の祝日 と「稽古休み」---
            eventDates["2027-01-02"] = { type: "closed", text: "稽古休み" };
            eventDates["2027-01-06"] = { type: "closed", text: "稽古休み" };
            eventDates["2027-01-01"] = { type: "holiday", text: "元日" };
            eventDates["2027-01-11"] = { type: "holiday", text: "成人の日" };
            eventDates["2027-02-11"] = { type: "holiday", text: "建国記念の日" };
            eventDates["2027-02-23"] = { type: "holiday", text: "天皇誕生日" };
            eventDates["2027-03-20"] = { type: "holiday", text: "春分の日" };
            eventDates["2027-04-29"] = { type: "holiday", text: "昭和の日" };
            eventDates["2027-05-03"] = { type: "holiday", text: "憲法記念日" };
            eventDates["2027-05-04"] = { type: "holiday", text: "みどりの日" };
            eventDates["2027-05-05"] = { type: "holiday", text: "こどもの日" };
            eventDates["2027-07-19"] = { type: "holiday", text: "海の日" };
            eventDates["2027-08-11"] = { type: "holiday", text: "山の日" };
            eventDates["2027-09-20"] = { type: "holiday", text: "敬老の日" };
            eventDates["2027-09-23"] = { type: "holiday", text: "秋分の日" };
            eventDates["2027-10-11"] = { type: "holiday", text: "スポーツの日" };
            eventDates["2027-11-03"] = { type: "holiday", text: "文化の日" };
            eventDates["2027-11-23"] = { type: "holiday", text: "勤労感謝の日" };
            eventDates["2027-12-25"] = { type: "closed", text: "稽古休み" };
            eventDates["2027-12-29"] = { type: "closed", text: "稽古休み" };

            // --- 2028年からの国民の祝日 と「稽古休み」---
            eventDates["2028-01-01"] = { type: ["event", "closed", "holiday"], text: ["元日", "稽古休み"]};
            eventDates["2028-01-05"] = { type: "closed", text: "稽古休み" };
            eventDates["2028-01-03"] = { type: "holiday", text: "振替休日" };
            eventDates["2028-01-10"] = { type: "holiday", text: "成人の日" };
            eventDates["2028-02-11"] = { type: "holiday", text: "建国記念の日" };
            eventDates["2028-02-12"] = { type: "holiday", text: "振替休日" };
            eventDates["2028-02-23"] = { type: "holiday", text: "天皇誕生日" };
            eventDates["2028-03-20"] = { type: "holiday", text: "春分の日" };
            eventDates["2028-04-29"] = { type: "holiday", text: "昭和の日" };
            eventDates["2028-05-03"] = { type: "holiday", text: "憲法記念日" };
            eventDates["2028-05-04"] = { type: "holiday", text: "みどりの日" };
            eventDates["2028-05-05"] = { type: "holiday", text: "こどもの日" };
            eventDates["2028-07-17"] = { type: "holiday", text: "海の日" };
            eventDates["2028-08-11"] = { type: "holiday", text: "山の日" };
            eventDates["2028-09-18"] = { type: "holiday", text: "敬老の日" };
            eventDates["2028-09-22"] = { type: "holiday", text: "秋分の日" };
            eventDates["2028-10-09"] = { type: "holiday", text: "スポーツの日" };
            eventDates["2028-11-03"] = { type: "holiday", text: "文化の日" };
            eventDates["2028-11-23"] = { type: "holiday", text: "勤労感謝の日" };
            eventDates["2028-12-28"] = { type: "closed", text: "稽古休み" };

            // --- 2029年からの国民の祝日 と「稽古休み」---
            eventDates["2029-01-02"] = { type: "closed", text: "稽古休み" };
            eventDates["2029-01-05"] = { type: "closed", text: "稽古休み" };
            eventDates["2029-01-01"] = { type: "holiday", text: "元日" };
            eventDates["2029-01-08"] = { type: "holiday", text: "成人の日" };
            eventDates["2029-02-11"] = { type: "holiday", text: "建国記念の日" };
            eventDates["2029-02-12"] = { type: "holiday", text: "振替休日" };
            eventDates["2029-02-23"] = { type: "holiday", text: "天皇誕生日" };
            eventDates["2029-03-20"] = { type: "holiday", text: "春分の日" };
            eventDates["2029-04-29"] = { type: "holiday", text: "昭和の日" };
            eventDates["2029-04-30"] = { type: "holiday", text: "振替休日" };
            eventDates["2029-05-03"] = { type: "holiday", text: "憲法記念日" };
            eventDates["2029-05-04"] = { type: "holiday", text: "みどりの日" };
            eventDates["2029-05-05"] = { type: "holiday", text: "こどもの日" };
            eventDates["2029-07-16"] = { type: "holiday", text: "海の日" };
            eventDates["2029-08-11"] = { type: "holiday", text: "山の日" };
            eventDates["2029-09-17"] = { type: "holiday", text: "敬老の日" };
            eventDates["2029-09-23"] = { type: "holiday", text: "秋分の日" };
            eventDates["2029-09-24"] = { type: "holiday", text: "振替休日" }; // 国民の休日
            eventDates["2029-10-08"] = { type: "holiday", text: "スポーツの日" };
            eventDates["2029-11-03"] = { type: "holiday", text: "文化の日" };
            eventDates["2029-11-04"] = { type: "holiday", text: "振替休日" };
            eventDates["2029-11-23"] = { type: "holiday", text: "勤労感謝の日" };
            eventDates["2029-12-26"] = { type: "closed", text: "稽古休み" };
            eventDates["2029-12-29"] = { type: "closed", text: "稽古休み" };

            // --- 2030年からの国民の祝日 と「稽古休み」---
            eventDates["2030-01-02"] = { type: "closed", text: "稽古休み" };
            eventDates["2030-01-05"] = { type: "closed", text: "稽古休み" };
            eventDates["2030-01-01"] = { type: "holiday", text: "元日" };
            eventDates["2030-01-14"] = { type: "holiday", text: "成人の日" };
            eventDates["2030-02-11"] = { type: "holiday", text: "建国記念の日" };
            eventDates["2030-02-23"] = { type: "holiday", text: "天皇誕生日" };
            eventDates["2030-03-20"] = { type: "holiday", text: "春分の日" };
            eventDates["2030-04-29"] = { type: "holiday", text: "昭和の日" };
            eventDates["2030-05-03"] = { type: "holiday", text: "憲法記念日" };
            eventDates["2030-05-04"] = { type: "holiday", text: "みどりの日" };
            eventDates["2030-05-05"] = { type: "holiday", text: "こどもの日" };
            eventDates["2030-05-06"] = { type: "holiday", text: "振替休日" };
            eventDates["2030-07-15"] = { type: "holiday", text: "海の日" };
            eventDates["2030-08-11"] = { type: "holiday", text: "山の日" };
            eventDates["2030-08-12"] = { type: "holiday", text: "振替休日" };
            eventDates["2030-09-16"] = { type: "holiday", text: "敬老の日" };
            eventDates["2030-09-23"] = { type: "holiday", text: "秋分の日" };
            eventDates["2030-10-14"] = { type: "holiday", text: "スポーツの日" };
            eventDates["2030-11-03"] = { type: "holiday", text: "文化の日" };
            eventDates["2030-11-04"] = { type: "holiday", text: "振替休日" };
            eventDates["2030-11-23"] = { type: "holiday", text: "勤労感謝の日" };
            eventDates["2030-12-25"] = { type: "closed", text: "稽古休み" };
            eventDates["2030-12-28"] = { type: "closed", text: "稽古休み" };
            // --- イベント定義ここまで ---


            const currentYear = new Date().getFullYear();
            const currentMonth = new Date().getMonth();

            // 年のセレクト作成（±5年）
            for (let y = currentYear - 5; y <= currentYear + 5; y++) {
                const opt = document.createElement("option");
                opt.value = y;
                opt.textContent = y + "年";
                if (y === currentYear) opt.selected = true;
                yearSelect.appendChild(opt);
            }

            // 月の初期値を現在の月に
            monthSelect.value = currentMonth;

            const days = ["日", "月", "火", "水", "木", "金", "土"];

            function renderCalendar(year, month) {
                const date = new Date(year, month, 1);
                const firstDayIndex = date.getDay(); // 月の最初の日の曜日 (0=日, 6=土)
                const lastDate = new Date(year, month + 1, 0).getDate(); // 月の最終日

                let html = `<table id="calendar-table"><thead><tr>`;
                for (let d of days) {
                    html += `<th>${d}</th>`;
                }
                html += `</tr></thead><tbody><tr>`;

                // 月の最初の曜日まで空のセルを挿入
                for (let i = 0; i < firstDayIndex; i++) {
                    html += `<td></td>`;
                }

                // 日付のセルを生成
                for (let d = 1; d <= lastDate; d++) {
                    const current = new Date(year, month, d);
                    const dayOfWeek = current.getDay(); // 0=日, 6=土
                    // ISO 8601形式のYYYY-MM-DDを生成
                    const formattedDate = `${year}-${(month + 1).toString().padStart(2, '0')}-${d.toString().padStart(2, '0')}`;

                    let classes = [];
                    let additionalTexts = []; // 日付の下に表示するテキスト（複数対応）

                    const eventInfo = eventDates[formattedDate];
                    const isHoliday = eventInfo && (eventInfo.type === "holiday" || (Array.isArray(eventInfo.type) && eventInfo.type.includes("holiday")));
                    const isClosedDay = eventInfo && (eventInfo.type === "closed" || (Array.isArray(eventInfo.type) && eventInfo.type.includes("closed")));
                    const isGeneralEvent = eventInfo && (eventInfo.type === "event" || (Array.isArray(eventInfo.type) && eventInfo.type.includes("event")));
                    
                    // --- Text Color Classes ---
                    if (dayOfWeek === 0) { // Sunday
                        classes.push("sunday-text"); 
                    } else if (dayOfWeek === 6) { // Saturday
                        classes.push("saturday-text");
                    }
                    // 祝日の文字色はCSSの.holidayクラスで設定されます。

                    // --- Background Color Classes ---
                    // 優先順位: 祝日/日曜日背景 > 土曜日背景 > 休みの日背景 > デフォルト (白)
                    if (isHoliday || dayOfWeek === 0) { // 祝日または日曜日の場合
                        classes.push("holiday-or-sunday-background"); // 薄い赤色の背景
                        if (isHoliday) {
                            classes.push("holiday"); // 祝日の文字色（赤）を適用するため
                        }
                    } else if (dayOfWeek === 6) { // 土曜日（祝日ではない場合）
                        classes.push("saturday-background"); // 薄い水色の背景
                    } else if (isClosedDay) { // その他の休みの日（祝日/日曜日/土曜日ではない場合）
                        classes.push("closed-non-training-day"); // 薄い赤色の背景
                    }
                    // 水曜日を含むその他の平日は、デフォルトで白い背景になります。

                    // --- Additional Texts (例: 稽古休み, 稽古日, 祝日名) ---
                    const addedTextsSet = new Set(); 

                    if (eventInfo) {
                        let textsToProcess = Array.isArray(eventInfo.text) ? eventInfo.text : [eventInfo.text];

                        textsToProcess.forEach(text => {
                            if (addedTextsSet.has(text)) return; 

                            if (text === "稽古休み") {
                                additionalTexts.push(`<span class="closed-text">${text}</span>`);
                                addedTextsSet.add(text);
                            } else if (["元日", "成人の日", "建国記念の日", "天皇誕生日", "春分の日", "昭和の日", "憲法記念日", "みどりの日", "こどもの日", "海の日", "山の日", "敬老の日", "秋分の日", "スポーツの日", "文化の日", "勤労感謝の日", "振替休日", "国民の休日", ].includes(text)) { // 長期休みも祝日名として追加
                                additionalTexts.push(`<span class="event-text">${text}</span>`);
                                addedTextsSet.add(text);
                            } else if (eventInfo.type === "event" || (Array.isArray(eventInfo.type) && eventInfo.type.includes("event"))) {
                                additionalTexts.push(`<span class="event-text">${text}</span>`);
                                addedTextsSet.add(text);
                            }
                        });
                    }

                    // 「稽古日」の表示ロジック
                    // 水曜日か土曜日で、休み・祝日・その他のイベントでない場合のみ「稽古日」テキストを表示
                    const shouldDisplayTrainingText = (dayOfWeek === 3 || dayOfWeek === 6) && !isClosedDay && !isHoliday && !isGeneralEvent && !addedTextsSet.has("稽古日");
                    if (shouldDisplayTrainingText) {
                        additionalTexts.push('<span class="training-text">稽古日</span>');
                    }
                    
                    // 今日の日付のスタイルを最優先で適用
                    const isToday = current.toDateString() === new Date().toDateString();
                    if (isToday) classes.push("today");

                    // 日付を.day-numberで囲むように変更
                    html += `<td class="${classes.join(" ")}"><span class="day-number">${d}</span>${additionalTexts.join("")}</td>`;
                    
                    // 週の終わり（土曜日）で新しい行を開始
                    if (dayOfWeek === 6 && d !== lastDate) {
                        html += `</tr><tr>`;
                    }
                }

                // 月の最終日以降の空のセルを挿入
                const lastDayOfWeek = new Date(year, month, lastDate).getDay();
                // 最後の週が土曜日で終わらない場合、残りの曜日分だけ空のセルを追加
                // 日曜日始まりのカレンダーなので、0 (日) から 6 (土) まで
                // lastDayOfWeek が 0 (日) の場合、6個の空セルが必要
                // lastDayOfWeek が 6 (土) の場合、0個の空セルが必要
                const remainingCells = 6 - lastDayOfWeek;
                for (let i = 0; i < remainingCells; i++) {
                    html += `<td></td>`;
                }

                html += `</tr></tbody></table>`;
                calendarDiv.innerHTML = html;
            }

            // 月ごとのお知らせを更新する関数
            function updateMonthlyNoticeSection(year, month) {
                let dynamicNoticeContent = ''; // 月ごとの動的なお知らせ用
                // 祝日名のリストを定義
                const holidayNames = ["元日", "成人の日", "建国記念の日", "天皇誕生日", "春分の日", "昭和の日", "憲法記念日", "みどりの日", "こどもの日", "海の日", "山の日", "敬老の日", "秋分の日", "スポーツの日", "文化の日", "勤労感謝の日", "振替休日", "国民の休日"];

                const noticesForCurrentMonth = Object.keys(eventDates)
                    .filter(dateStr => {
                        const [y, m, d] = dateStr.split('-').map(Number);
                        return y === year && (m - 1) === month; // 月は0から始まるため -1
                    })
                    .sort(); // 日付順にソート

                if (noticesForCurrentMonth.length > 0) {
                    noticesForCurrentMonth.forEach(dateStr => {
                        const eventInfo = eventDates[dateStr];
                        const dateObj = new Date(dateStr);
                        const displayDate = `${dateObj.getMonth() + 1}月${dateObj.getDate()}日（${days[dateObj.getDay()]}）`;
                        
                        let typesForDate = Array.isArray(eventInfo.type) ? eventInfo.type : [eventInfo.type];
                        let textsForDate = Array.isArray(eventInfo.text) ? eventInfo.text : [eventInfo.text];

                        const addedTextsToNotice = new Set(); // 重複および表示済み（またはスキップ済み）テキストを追跡

                        // まず、祝日名を除外する
                        textsForDate = textsForDate.filter(text => !holidayNames.includes(text));

                        // 残ったテキスト（演武会、稽古休み、審査など）を処理
                        textsForDate.forEach(text => {
                            if (addedTextsToNotice.has(text) || text === "稽古日") { 
                                return; // 既に通知に追加済み、または「稽古日」テキストはスキップ
                            }
                            dynamicNoticeContent += `<p><small>${displayDate}は${text}。</small></p>`;
                            addedTextsToNotice.add(text);
                        });

                        // 稽古日（水曜日または土曜日で、祝日でも稽古休みでも他のイベントでもない場合）
                        const dayOfWeek = dateObj.getDay();
                        const isTrainingDayCandidate = (dayOfWeek === 3 || dayOfWeek === 6); // 水曜日または土曜日
                        
                        // 該当の日が「holiday」タイプを含まないことを確認
                        const isNotHolidayType = !typesForDate.includes("holiday");
                        
                        // 既に「稽古休み」やその他のイベント（演武会、審査会など）が追加されていないことを確認
                        const hasNoOtherSpecificNotice = addedTextsToNotice.size === 0;

                        if (isTrainingDayCandidate && isNotHolidayType && hasNoOtherSpecificNotice) {
                            dynamicNoticeContent += `<p><small>${displayDate}は稽古日。</small></p>`;
                            addedTextsToNotice.add("稽古日"); // 追加したことを記録
                        }
                    });
                } else {
                    dynamicNoticeContent += '<p><small>今月のお知らせはありません。</small></p>';
                }

                if (monthlyDynamicNoticeDiv) {
                    monthlyDynamicNoticeDiv.innerHTML = dynamicNoticeContent;
                }
            }


            // 初期表示
            renderCalendar(currentYear, currentMonth);
            updateMonthlyNoticeSection(currentYear, currentMonth); // 初期表示時のお知らせ

            yearSelect.addEventListener("change", () => {
                const year = parseInt(yearSelect.value);
                const month = parseInt(monthSelect.value);
                renderCalendar(year, month);
                updateMonthlyNoticeSection(year, month); // 年変更時のお知らせ更新
            });

            monthSelect.addEventListener("change", () => {
                const year = parseInt(yearSelect.value);
                const month = parseInt(monthSelect.value);
                renderCalendar(year, month);
                updateMonthlyNoticeSection(year, month); // 月変更時のお知らせ更新
            });
        }); // DOMContentLoaded 閉じタグ
    </script>
</body>
</html>
